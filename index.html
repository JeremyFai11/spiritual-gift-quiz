<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>線上互動屬靈恩賜評估問卷</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        /* 自訂 radio button 樣式 */
        .custom-radio:checked {
            background-color: #3b82f6; /* bg-blue-600 */
            border-color: #3b82f6; /* border-blue-600 */
        }
        .custom-radio:checked + label {
            color: #1e40af; /* text-blue-800 */
            font-weight: 500;
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="app" class="container mx-auto p-4 sm:p-6 md:p-8 max-w-4xl">
        
        <!-- 問卷標題 -->
        <header id="header" class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">屬靈恩賜評估問卷</h1>
            <p class="mt-2 text-gray-600">請根據您的真實感受和經歷，誠實地回答以下問題。</p>
        </header>

        <!-- 進度條 -->
        <div id="progress-container" class="w-full bg-gray-200 rounded-full h-4 mb-6 sticky top-2 z-10 shadow-inner">
            <div id="progress-bar" class="bg-blue-600 h-4 rounded-full progress-bar-fill text-xs font-medium text-blue-100 text-center p-0.5 leading-none" style="width: 0%">
                <span id="progress-text">0%</span>
            </div>
        </div>

        <!-- 問題容器 -->
        <div id="questionnaire-container" class="space-y-6">
            <!-- 問題將由 JavaScript 動態生成於此 -->
        </div>

        <!-- 操作按鈕 -->
        <div id="actions-container" class="mt-8 text-center">
            <button id="calculate-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition duration-300 transform hover:scale-105">
                計算結果
            </button>
        </div>

        <!-- 結果容器 (預設隱藏) -->
        <div id="results-container" class="hidden mt-8 bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-2xl md:text-3xl font-bold text-center mb-6 text-gray-800">您的評估結果</h2>
            <div id="results-list" class="space-y-4">
                <!-- 結果將由 JavaScript 動態生成於此 -->
            </div>
            <div class="mt-8 text-center">
                <button id="restart-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition duration-300">
                    重新評估
                </button>
            </div>
        </div>

        <!-- 頁尾 -->
        <footer class="text-center mt-12 text-sm text-gray-500 space-y-2">
            <p>本評估僅為參考工具，恩賜的確認最終需要在教會群體中完成。</p>
            <p>版權來源：「李察侯氏、彼得韋拿著，《教會增長系列⑤你的屬靈恩賜測試表》（香港：迎欣，2004）」</p>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // 問題數據
            const questions = [
                "我一直有個願望，要傳遞直接從神來的訊息，來建立、鼓勵和安慰別人。", "我一直喜歡同一班人長期相處，與他們分享成功，分擔失敗。", "人家告訴我，說我幫了他們很有意義地學習了《聖經》真理。", "在我自己生命中，我有效地應用了屬靈真理。", "人家告訴我，說我幫了他們分析了《聖經》中很重要的事實。", "我常說話鼓勵那些動搖、受苦和失望的人。", "教會的人發覺我常常在別人還沒注意的時候，就看穿虛偽。", "我發覺我善於理財，所以能慷慨奉獻支持神的工作。", "我經常協助屬靈領袖，以致他們能專注做最重要的事工。", "我有一個願望，要幫助那些身體或思覺有障礙的，來減輕他們的痛苦。", "與別的種族或少數民族人相處，我覺得很自在；他們也好像接納我。", "我有帶領人相信耶穌，決志接受救恩。", "我家的大門，一直為有需要留宿的人打開的。", "在一群人當中，別人常是要我來決定異象和方向。", "我講話的時候，大家好像都聽從。", "在一群人當中，若果少了組織，我往往就填補這空缺。", "人家能清楚指明，我的禱告，帶出可以看到的神蹟。", "奉主耶穌的名，我被使用來即時醫治疾病。", "我講方言。", "有時候人家講方言，我能感受到神要傳達什麼。", "我可以生活得更舒適，但我選擇與貧窮的人一同生活。", "我是單身，而且很滿足。", "我每天起碼禱告一小時。", "我斥責邪靈，它們順服我。", "我喜歡教會叫我去做一些庶務。",
                "藉著神，我向別人啟示了將來要發生的事。", "我樂意負起照料一群基督徒的屬靈生命。", "我覺得我能將《新約》對基督身體（教會）的健康和事奉，解釋得適切。", "對相當複雜的困難，我能天性地達至解決。", "我對一些屬靈真理有特別見解，別人說我幫到他們更親近神。", "有需要的時候，我能高效地動員別人參與事奉。", "有時我能“看見”聖靈降臨在某些人身上。", "按照記錄，我奉獻大大超過十分之一來支持聖工。", "別人告訴我，說我幫助了他們的事奉，更為高效。", "別人有物質或身體上的缺乏，我肯去照料。", "我覺得我能學會另一種語言，以致能在不同的文化當中服事。", "我曾喜樂洋洋地向非信徒，適切清楚分享神怎樣拯救我。", "我喜歡負責教會聚餐及其他社交。", "我相信神能行不可能之事，並且實實際際地看過祂的作為。", "其他基督徒跟從我的領導，因為他們相信我。", "我享受整理細則，組織計劃，安排人力、物力、時間，來叫事奉更有效。", "神使用我這個人行出超然的神蹟奇事。", "我喜歡為病人禱告，因為我知道許多會得著醫治。", "我用未曾學過的語言，向神的子民傳達神對現況的訊息。", "我繙方言，結果是基督的身體得著建立、激勵和安慰。", "簡樸生活對我來說是一個很興奮的挑戰。", "人家注意到我對結婚好像沒有什麼大興趣。", "當我聽到一個代禱事項，我至少會用幾日時間為這件事禱告。", "我聽過污鬼大聲說話。", "我沒有什麼才幹，但教會的事務需要做我就做。",
                "人家告訴我，說我傳達的訊息合時又緊急，必定是直接從神而來。", "在一群信徒當中，我不怕提供指導和方向。", "我可以花許多時間來學習新的《聖經》真理，以致我能向別人傳遞。", "當別人有困難，我往往可以帶領他在《聖經》裡找到最好的解決。", "靠學習或經驗，我發覺神有一些重要的策略和方法，來發展祂的國度。", "別人在他們痛苦及困難中會來找我；之後告訴我說，他們得到了幫助、釋放或醫治。", "我可以相當有把握地判斷一個人是受邪靈攪擾。", "當我受到感動，要奉獻支持聖工，我通常能找到我需要的金錢。", "我喜歡做刻板、固定的工作，而使到別人的事奉更有果效。", "我喜歡去醫院或老人院探訪：而我覺得自己在這種事工上，做得蠻好。", "其他種族或文化的人受我吸引，而我們雙方來往得很融治。", "非基督徒覺得和我相處蠻自然，而我亦能積極影響他們開展對基督的信仰。", "客人來我們家，他們會說好像賓至如歸一樣。", "人家告訴我，說我有信心做成他們都認為不可能的事。", "當我訂目標時，別人好像很容易接納。", "我能夠為一群人作有效率的計劃，來達成大家的目標。", "神好像經常用我的生命來成就不可能的事。", "人家告訴我，說因為我的服事，在感情困難上，神醫治了他們。", "我能用我從來沒有學過的語言向神傾談。", "我祈求希望別人說方言時，我能作繙譯。", "我不是貧困，但我能和貧困的人認同。", "由於我是單身，我很高興我有更多時間事奉神。", "花時間作代禱是我最喜歡的。", "人家發覺有人可能受邪靈困擾，他們會來找我。", "人家告訴我，說我喜歡做重複的事，並且做得特別好。",
                "我有時強烈感受到，神對一個場合有重要的信息要傳遞。", "我幫助別的信徒，帶領他們在《聖經》裡找到適切的經文，並且帶他們一同祈禱。", "我覺得我向別人解釋《聖經》真理，不單能夠帶出知識增長，更能改變別人的態度、價值觀和行為。", "人家告訴我，說我對《聖經》真理有特別的領受，並且能夠應用在眾人的需要上。", "我落不少功夫來研讀，為的是學習新的《聖經》真理。", "我有一個願望，要有果效地輔導迷茫的、犯罪的和受毒品捆綁的人。", "我能分辨出一個人的教導，是出自神，出自撒旦，或出自人意。", "我全然確信神會供應我一切需要，所以我持之以恆的大大奉獻。", "當我做幕後工作而別人得到幫助，我就心滿意足。", "別人看到不幸，會找我去幫手。", "我願意離開舒逸的環境，如果我能夠更有果效地向更多人分享基督。", "別人不像我一樣向未信主的人見證耶穌，我會覺得氣惱。", "人家告訴我，說我好客。", "有時我很確實神有特別的旨意，來擴展祂的事工——就算別人不能肯定。", "當我加入一個團隊，其他人自然退縮，並且期待我帶頭。", "我不用太多說服，也能給人指示來完成一件工作。", "人家告訴我，說我成了神的工具，帶出生命及環境上超然的改變。", "我為病人禱告，醫治實實在在出現。", "當我在公開場合說方言，我期待有繙譯。", "我繙譯方言，別人得到祝福。", "人家告訴我，說我犧牲太大來作事奉。", "我單身，但我控制性的困擾不太大。", "人家告訴我，說我為他們的禱告得到實實在在的應允。", "我禱告，別人即時在污鬼邪靈捆綁中得釋放。", "我寧可積極採取行動，好過坐下來談話、閱讀、或聽別人講話。",
                "我有時清楚確實知道神在事奉上要做的是什麼。", "人家告訴我，說我把他們重新帶回基督大家庭。", "研讀《聖經》，把自己的見解與別人分享，是很滿足的。", "當要作重要的決定，我感受到神奇異的同在，並且得到信心。", "我能夠憑閱讀和觀察，自己發現新真理。", "我說服別人在《聖經》中找良方，來解決他們的困難和痛苦。", "我能分辨出一個人說方言，是真是假。", "我甘願過一個比較低水平的生活，以致造益神的工作。", "當我服事神的時候，我根本不理誰得稱讚。", "我樂意和一個孤寂的，好像坐牢的人，共度時間。", "比起別人，我有一個強烈的願望，要別的地方的人歸主。", "我對非信徒特別好感，希望能贏取他們信主。", "我願意幾時有需要，幾時我的家就打開，來款待神的僕人。", "人家告訴我，說我有特別的異象；這點我同意。", "由我負責時，事情就進行得順利。", "我享受在教會中擔任一個特別的責任，而且看到它成功。", "奉主的名，我叫瞎眼的重見光明。", "當我為病人禱告，一就是我自己，一就是對方，總會覺得熱和震顫。", "當我說方言，我相信是建立主的身體。", "我繙譯方言時，好像是神直接傳遞訊息給我們。", "窮人家接納我，因為我選擇過他們的生活水平。", "我沒有困難認同保羅獨身的心願。", "當我禱告時，神經常向我說話。我認識祂的聲音。", "我奉主名趕鬼。", "人家要我做的，看來是瑣事，我也樂意接受。"
            ];

            // 恩賜類別
            const gifts = [
                "預言", "牧養", "教導", "智慧", "知識", "勸化", "辨別諸靈", "施惠（奉獻）", "幫助人", "憐憫人",
                "宣教士", "傳福音", "款待", "信心", "治理", "行政", "神蹟", "醫病", "方言", "繙方言",
                "自願清貧", "獨身", "代禱", "趕鬼", "執事"
            ];
            
            let shuffledQuestions = [];

            const questionnaireContainer = document.getElementById('questionnaire-container');
            const calculateBtn = document.getElementById('calculate-btn');
            const resultsContainer = document.getElementById('results-container');
            const resultsList = document.getElementById('results-list');
            const restartBtn = document.getElementById('restart-btn');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');

            // 將問題與其原始索引配對，以便之後計分
            function prepareAndShuffleQuestions() {
                let questionsWithOriginalIndex = questions.map((q, index) => ({
                    text: q,
                    originalIndex: index
                }));

                // Fisher-Yates (aka Knuth) Shuffle 演算法打亂問題順序
                for (let i = questionsWithOriginalIndex.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [questionsWithOriginalIndex[i], questionsWithOriginalIndex[j]] = [questionsWithOriginalIndex[j], questionsWithOriginalIndex[i]];
                }
                
                shuffledQuestions = questionsWithOriginalIndex;
            }

            // 渲染問題
            function renderQuestions() {
                questionnaireContainer.innerHTML = ''; // 清空舊問題
                shuffledQuestions.forEach((q_item, display_index) => {
                    const questionBlock = document.createElement('div');
                    questionBlock.className = 'bg-white p-5 rounded-lg shadow-md border-l-4 border-gray-200 transition duration-300 hover:shadow-lg hover:border-blue-500';
                    
                    const questionText = document.createElement('p');
                    questionText.className = 'font-semibold text-gray-700 mb-4';
                    // 顯示的是打亂後的順序 (1, 2, 3...)
                    questionText.textContent = `${display_index + 1}. ${q_item.text}`;
                    
                    const optionsContainer = document.createElement('div');
                    optionsContainer.className = 'flex flex-wrap gap-x-6 gap-y-3';

                    const options = [
                        { label: '許多', value: 3 },
                        { label: '有些', value: 2 },
                        { label: '少少', value: 1 },
                        { label: '沒有', value: 0 }
                    ];

                    options.forEach(opt => {
                        const optionWrapper = document.createElement('div');
                        optionWrapper.className = 'flex items-center';
                        
                        const radioInput = document.createElement('input');
                        radioInput.type = 'radio';
                        // ID 和 Name 使用原始索引確保唯一性
                        radioInput.id = `q${q_item.originalIndex}_${opt.value}`;
                        radioInput.name = `question_${q_item.originalIndex}`;
                        radioInput.value = opt.value;
                        radioInput.className = 'custom-radio h-5 w-5 rounded-full border-2 border-gray-300 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-50 cursor-pointer';
                        radioInput.addEventListener('change', updateProgress);

                        const label = document.createElement('label');
                        label.htmlFor = `q${q_item.originalIndex}_${opt.value}`;
                        label.textContent = opt.label;
                        label.className = 'ml-2 text-gray-600 cursor-pointer';

                        optionWrapper.appendChild(radioInput);
                        optionWrapper.appendChild(label);
                        optionsContainer.appendChild(optionWrapper);
                    });

                    questionBlock.appendChild(questionText);
                    questionBlock.appendChild(optionsContainer);
                    questionnaireContainer.appendChild(questionBlock);
                });
            }
            
            // 更新進度條
            function updateProgress() {
                const totalQuestions = questions.length;
                const answeredQuestions = document.querySelectorAll('input[type="radio"]:checked').length;
                const percentage = Math.round((answeredQuestions / totalQuestions) * 100);
                progressBar.style.width = `${percentage}%`;
                progressText.textContent = `${percentage}%`;
            }

            // 計算分數
            calculateBtn.addEventListener('click', () => {
                const totalQuestions = questions.length;
                const answeredQuestions = document.querySelectorAll('input[type="radio"]:checked').length;
                if (answeredQuestions < totalQuestions) {
                    showCustomAlert('請回答所有問題才能計算結果。');
                    return;
                }

                const scores = Array(gifts.length).fill(0);

                // 根據原始索引來計分
                for (let i = 0; i < totalQuestions; i++) {
                    const selectedOption = document.querySelector(`input[name="question_${i}"]:checked`);
                    if (selectedOption) {
                        const score = parseInt(selectedOption.value, 10);
                        const categoryIndex = i % gifts.length;
                        scores[categoryIndex] += score;
                    }
                }

                displayResults(scores);
            });

            // 顯示結果
            function displayResults(scores) {
                const resultsData = gifts.map((gift, index) => ({
                    gift: gift,
                    category: String.fromCharCode(65 + index), // A, B, C...
                    score: scores[index]
                }));

                resultsData.sort((a, b) => b.score - a.score);
                resultsList.innerHTML = '';

                resultsData.forEach((result, index) => {
                    const resultItem = document.createElement('div');
                    resultItem.className = 'p-4 rounded-lg flex items-center justify-between transition duration-300';
                    
                    if (index < 3) {
                        resultItem.classList.add('bg-blue-100', 'border-l-4', 'border-blue-500');
                    } else if (index < 7) {
                        resultItem.classList.add('bg-gray-100');
                    } else {
                        resultItem.classList.add('bg-gray-50');
                    }

                    const rankSpan = document.createElement('span');
                    rankSpan.className = 'text-lg font-bold text-blue-600 w-8';
                    rankSpan.textContent = `#${index + 1}`;

                    const giftInfo = document.createElement('div');
                    giftInfo.className = 'flex-grow ml-4';
                    
                    const giftName = document.createElement('p');
                    giftName.className = 'text-lg font-semibold text-gray-800';
                    giftName.textContent = `${result.gift} (${result.category})`;

                    const scoreBarContainer = document.createElement('div');
                    scoreBarContainer.className = 'w-full bg-gray-200 rounded-full h-2.5 mt-1';
                    const scoreBarFill = document.createElement('div');
                    const maxScore = 15; // 5 questions * 3 points
                    const scorePercentage = (result.score / maxScore) * 100;
                    scoreBarFill.className = 'bg-blue-500 h-2.5 rounded-full';
                    scoreBarFill.style.width = `${scorePercentage}%`;
                    scoreBarContainer.appendChild(scoreBarFill);
                    
                    giftInfo.appendChild(giftName);
                    giftInfo.appendChild(scoreBarContainer);
                    
                    const scoreSpan = document.createElement('span');
                    scoreSpan.className = 'text-xl font-bold text-gray-700 ml-4';
                    scoreSpan.textContent = result.score;
                    
                    resultItem.appendChild(rankSpan);
                    resultItem.appendChild(giftInfo);
                    resultItem.appendChild(scoreSpan);
                    
                    resultsList.appendChild(resultItem);
                });

                document.getElementById('questionnaire-container').classList.add('hidden');
                document.getElementById('actions-container').classList.add('hidden');
                document.getElementById('progress-container').classList.add('hidden');
                document.getElementById('header').classList.add('hidden');
                resultsContainer.classList.remove('hidden');
                window.scrollTo(0, 0);
            }

            // 重新開始
            function startNewAssessment() {
                resultsContainer.classList.add('hidden');
                document.getElementById('questionnaire-container').classList.remove('hidden');
                document.getElementById('actions-container').classList.remove('hidden');
                document.getElementById('progress-container').classList.remove('hidden');
                document.getElementById('header').classList.remove('hidden');
                
                prepareAndShuffleQuestions();
                renderQuestions();
                updateProgress();
                window.scrollTo(0, 0);
            }

            restartBtn.addEventListener('click', startNewAssessment);

            // 自訂提示框函數
            function showCustomAlert(message) {
                const oldAlert = document.getElementById('custom-alert');
                if (oldAlert) oldAlert.remove();

                const alertBox = document.createElement('div');
                alertBox.id = 'custom-alert';
                alertBox.className = 'fixed top-5 left-1/2 -translate-x-1/2 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg shadow-lg z-50 transition-opacity duration-300';
                alertBox.textContent = message;
                
                document.body.appendChild(alertBox);

                setTimeout(() => {
                    alertBox.style.opacity = '0';
                    setTimeout(() => alertBox.remove(), 300);
                }, 3000);
            }

            // 初始化
            startNewAssessment();
        });
    </script>
</body>
</html>
